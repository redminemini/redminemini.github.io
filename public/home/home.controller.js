!function(){"use strict";function e(e,t,n){function s(e){return c.resjsontasks.filter(t=>t.id_list==e)}function i(e){for(let t=0;t<e.length;t++)c["list_"+e[t].id]=s(e[t].id),c["list_"+e[t].id].name=e[t].name,c.rawScreens.push(c["list_"+e[t].id])}function l(e,t){event.preventDefault(),c["list_"+e].splice(_.indexOf(c["list_"+e],_.find(c["list_"+e],function(e){return e.id===t})),1),c.resjsontasks.splice(_.indexOf(c.resjsontasks,_.find(c.resjsontasks,function(e){return e.id===t})),1)}function o(){c.rawScreens=[],i(c.resgetJsonLists)}function a(e,t,n){event.preventDefault();let s=_.find(c["list_"+e],function(e){return e.id===t});for(let e in s)c["html_"+e]=s[e];c.html_t_index=n+1,$("#openModal").fadeToggle()}function r(e,t){return $.map(e,function(e,n){if(e.id==t)return n})[0]}function d(){e.GetAll().then(function(e){c.allUsers=e})}var c=this;c.tasck_limit=15,c.ngGridView=null,c.user=null,c.allUsers=[],c.deleteUser=function(t){e.Delete(t).then(function(){d()})},c.exit_modal=function(){event.preventDefault(),$(".modalDialog").fadeToggle()},c.savetasck=function(e,t,n){if(event.preventDefault(),1==confirm("Сохранить?")){let e=r(c.resjsontasks,t);for(let t in c.resjsontasks[0])"$$hashKey"!=t&&("date"==t||"title"==t?"date"==t?c.resjsontasks[e].date=$("#dtpckr")[0].value:c.resjsontasks[e].title=$("#ttl")[0].value:c.resjsontasks[e][t]=c["html_"+t]);1==c.change&&(o(),c.change=!1)}$(".modalDialog").fadeToggle()},c.edittasck=a,c.deltasck=l,c.addtasck=function(e){if(event.preventDefault(),c["list_"+e].length<c.tasck_limit){var t=c.resjsontasks[0];let n="{";for(let s in t)"id"!=s?"title"==s?n=n+'"'+s+'": "NewTasck '+e+u+'",':"id_list"==s?n=n+'"'+s+'": '+Number(e):"description"==s||"date"==s?n="date"==s?n+'"'+s+'" : "08.12.2017",':n+'"'+s+'" : "1",':"$$hashKey"!=s&&(n=n+'"'+s+'" : 1,'):n=n+'"id" : '+Math.floor(Date.now()/1e3)+",";n+="}",c.resjsontasks.push(JSON.parse(n)),o(),u++}},c.def_click=function(){event.preventDefault()},c.finish_loader=function(){$("#loader").is(":visible")&&$("#loader").fadeToggle()},c.start_loader=function(){$("#loader").is(":visible")||$("#loader").fadeToggle()},c.logModels=function(){c.sortingLog=[];for(let t=0;t<c.rawScreens.length;t++){var e=c.rawScreens[t].map(function(e){return e.title+"-"+e.id_list+"|"}).join(", ");e="container "+(t+1)+": "+e,c.sortingLog.push(e)}},c.my_alert=function(e,t,n="def"){if(0==n&&l(t,e),1==n){let n=null;for(let s=0;s<c["list_"+t].length;s++)c["list_"+t][s].id==e&&(n=s);a(t,e,n)}},c.change_list=function(){c.change=!0},c.change=!1,c.rawScreens=[],c.sortingLog=[],c.resjsontasks=[],c.resgetJsonLists=[],c.sortableOptions={placeholder:"app",connectWith:".apps-container",update:function(e,t){!t.item.sortable.received&&t.item.sortable.source[0]!==t.item.sortable.droptarget[0]&&t.item.sortable.droptargetModel.length>=c.tasck_limit&&t.item.sortable.cancel()},stop:function(e,t){for(let e=0;e<c.rawScreens.length;e++)c.rawScreens[e].map(function(t){t.id_list=e+1})}},$("#dtpckr").datepicker();var f=[];e.GetByUsername(n.globals.currentUser.username).then(function(e){c.user=e}),d(),c.resgetJsonLists=t.getResultFromJson("db/listsName.json"),c.resjsontasks=t.getResultFromJson("db/tasks.json"),i(c.resgetJsonLists),f=t.getResultFromJson("db/gridname.json"),function(){c.ngGridView={data:"vm.resjsontasks",showSelectionCheckbox:!0,showFooter:!0,enableColumnResize:!0,enableCellSelection:!1,enableRowSelection:!0,enableCellEdit:!1,headerRowHeight:65,showFilter:!0,filterOptions:c.filterOptions,columnDefs:[]},c.filterOptions={filterText:"",useExternalFilter:!0};let e;c.status=[{id:1,name:"Ожидает"},{id:2,name:"В работе"},{id:3,name:"Выполнено"}];let t;c.dragndrop_list=[{id:1,name:"План"},{id:2,name:"В процессе"},{id:3,name:"Готово"}];let n=f.sort((e,t)=>e.sort-t.sort);for(let s=0;s<n.length;s++)"$$hashKey"!=n[s].id&&("execution_status"==n[s].id||"id_list"==n[s].id?(t="execution_status"==n[s].id?"<select disabled ng-cell-input ng-options='s.id as s.name for s in vm.status'ng-class='colt'ng-model='COL_FIELD'ng-input='COL_FIELD'data-placeholder='-- Select One --'></select>":"<select disabled ng-cell-input ng-options='s.id as s.name for s in vm.dragndrop_list'ng-class='colt'ng-model='COL_FIELD'ng-input='COL_FIELD'data-placeholder='-- Select One --'></select>",e='{"field" : "'+n[s].id+'","cellTemplate" : "'+t+'"}',c.ngGridView.columnDefs.push(JSON.parse(e))):(e='{"field" : "'+n[s].id+'","displayName" : "'+f[s].id+'"}',c.ngGridView.columnDefs.push(JSON.parse(e))));let s=["id"];for(let e=0;e<s.length;e++)for(let t=0;t<c.ngGridView.columnDefs.length;t++)if(c.ngGridView.columnDefs[t].field==s[e])c.ngGridView.columnDefs[t].visible=!1;else{let e=r(f,c.ngGridView.columnDefs[t].field);c.ngGridView.columnDefs[t].displayName=f[e].gridname,c.ngGridView.columnDefs[t].width=f[e].width}let i="<i class='fa fa-pencil-square-o btn btn-success btn-sm' ng-click='vm.my_alert(row.entity.id,row.entity.id_list,1)'></i>\"";e='{"field": "edit", "displayName": "...", "width": 40, "cellTemplate": "'+i+"}",c.ngGridView.columnDefs.push(JSON.parse(e)),e='{"field": "delete", "displayName": "...", "width": 40, "cellTemplate": "'+(i="<div><i class='fa fa-trash-o btn btn-danger btn-sm' ng-click='vm.my_alert(row.entity.id,row.entity.id_list,0)'></i></div>\"")+"}",c.ngGridView.columnDefs.push(JSON.parse(e))}();var u=0}angular.module("app").controller("HomeController",e),e.$inject=["UserService","JsonService","$rootScope"]}();